<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Examples &amp; Benchmarks · ExtendableSparse.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">ExtendableSparse.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Examples &amp; Benchmarks</a><ul class="internal"><li><a class="tocitem" href="#Matrix-creation-example"><span>Matrix creation example</span></a></li><li><a class="tocitem" href="#Matrix-creation-benchmark"><span>Matrix creation benchmark</span></a></li><li><a class="tocitem" href="#Matrix-update-benchmark"><span>Matrix update benchmark</span></a></li></ul></li><li><a class="tocitem" href="../extsparse/">Sparse matrix handling</a></li><li><a class="tocitem" href="../iter/">Preconditioners</a></li><li><a class="tocitem" href="../changes/">Changes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Examples &amp; Benchmarks</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Examples &amp; Benchmarks</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/j-fu/ExtendableSparse.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples-and-Benchmarks"><a class="docs-heading-anchor" href="#Examples-and-Benchmarks">Examples &amp; Benchmarks</a><a id="Examples-and-Benchmarks-1"></a><a class="docs-heading-anchor-permalink" href="#Examples-and-Benchmarks" title="Permalink"></a></h1><h2 id="Matrix-creation-example"><a class="docs-heading-anchor" href="#Matrix-creation-example">Matrix creation example</a><a id="Matrix-creation-example-1"></a><a class="docs-heading-anchor-permalink" href="#Matrix-creation-example" title="Permalink"></a></h2><p>An <code>ExtendableSparseMatrix</code> can serve as a drop-in replacement for <code>SparseMatrixCSC</code>, albeit with faster assembly during the buildup phase when using index based access. That means that code similar to the following example should be fast enough to avoid the assembly steps using the coordinate format:</p><pre><code class="language-julia">n=3
A=ExtendableSparseMatrix(n,n)
for i=1:n-1
    A[i,i+1]=i
end
A</code></pre><pre class="documenter-example-output">3×3 ExtendableSparseMatrix{Float64, Int64} with 2 stored entries:
  ⋅   1.0   ⋅ 
  ⋅    ⋅   2.0
  ⋅    ⋅    ⋅ </pre><h2 id="Matrix-creation-benchmark"><a class="docs-heading-anchor" href="#Matrix-creation-benchmark">Matrix creation benchmark</a><a id="Matrix-creation-benchmark-1"></a><a class="docs-heading-anchor-permalink" href="#Matrix-creation-benchmark" title="Permalink"></a></h2><p>The method <a href="../extsparse/#ExtendableSparse.fdrand-Union{Tuple{Tv}, Tuple{Any, Any, Any}} where Tv"><code>fdrand</code></a>  creates a matrix similar to the discretization matrix of a Poisson equation on a d-dimensional cube. The approach is similar to that of a typical finite element code: calculate a local stiffness matrix and assemble it into the global one.</p><h3 id="Benchmark-for-[ExtendableSparseMatrix](@ref)"><a class="docs-heading-anchor" href="#Benchmark-for-[ExtendableSparseMatrix](@ref)">Benchmark for <a href="../extsparse/#ExtendableSparse.ExtendableSparseMatrix"><code>ExtendableSparseMatrix</code></a></a><a id="Benchmark-for-[ExtendableSparseMatrix](@ref)-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmark-for-[ExtendableSparseMatrix](@ref)" title="Permalink"></a></h3><p>The code uses the index access API for the creation of the matrix, inserting elements via <code>A[i,j]+=v</code>, using an intermediate linked list structure which upon return ist flushed into a SparseMatrixCSC structure.</p><pre><code class="language-julia">@benchmark fdrand(30,30,30, matrixtype=ExtendableSparseMatrix);</code></pre><pre class="documenter-example-output">BenchmarkTools.Trial: 
  memory estimate:  8.16 MiB
  allocs estimate:  28
  --------------
  minimum time:     11.306 ms (0.00% GC)
  median time:      12.196 ms (0.00% GC)
  mean time:        12.340 ms (1.22% GC)
  maximum time:     17.582 ms (0.00% GC)
  --------------
  samples:          406
  evals/sample:     1</pre><h3 id="Benchmark-for-SparseMatrixCSC"><a class="docs-heading-anchor" href="#Benchmark-for-SparseMatrixCSC">Benchmark for  SparseMatrixCSC</a><a id="Benchmark-for-SparseMatrixCSC-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmark-for-SparseMatrixCSC" title="Permalink"></a></h3><p>Here, for comparison we use  a <code>SparseMatrixCSC</code> created with <code>spzeros</code> and insert entries via <code>A[i,j]+=v</code>.</p><pre><code class="language-julia">@benchmark fdrand(30,30,30, matrixtype=SparseMatrixCSC);</code></pre><pre class="documenter-example-output">BenchmarkTools.Trial: 
  memory estimate:  6.21 MiB
  allocs estimate:  38
  --------------
  minimum time:     695.878 ms (0.00% GC)
  median time:      719.298 ms (0.00% GC)
  mean time:        744.044 ms (0.00% GC)
  maximum time:     928.436 ms (0.00% GC)
  --------------
  samples:          7
  evals/sample:     1</pre><h3 id="Benchmark-for-intermediate-coordinate-format"><a class="docs-heading-anchor" href="#Benchmark-for-intermediate-coordinate-format">Benchmark for  intermediate coordinate format</a><a id="Benchmark-for-intermediate-coordinate-format-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmark-for-intermediate-coordinate-format" title="Permalink"></a></h3><p>A <code>SparseMatrixCSC</code> is created by accumulating data into arrays <code>I</code>,<code>J</code>,<code>A</code> and calling <code>sparse(I,J,A)</code></p><pre><code class="language-julia">@benchmark fdrand(30,30,30, matrixtype=:COO)</code></pre><pre class="documenter-example-output">BenchmarkTools.Trial: 
  memory estimate:  23.28 MiB
  allocs estimate:  78
  --------------
  minimum time:     11.806 ms (0.00% GC)
  median time:      13.124 ms (5.29% GC)
  mean time:        13.853 ms (6.11% GC)
  maximum time:     88.809 ms (84.87% GC)
  --------------
  samples:          361
  evals/sample:     1</pre><p>This is nearly on par with matrix creation via <code>ExtendableSparseMatrix</code>, but the later can be made faster:</p><h3 id="Benchmark-for-ExtendableSparseMatrix-with-updateindex"><a class="docs-heading-anchor" href="#Benchmark-for-ExtendableSparseMatrix-with-updateindex">Benchmark  for <code>ExtendableSparseMatrix</code> with <code>updateindex</code></a><a id="Benchmark-for-ExtendableSparseMatrix-with-updateindex-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmark-for-ExtendableSparseMatrix-with-updateindex" title="Permalink"></a></h3><p>Here, we use  a <code>ExtendableSparseMatrix created with</code>spzeros<code>and insert entries via</code>updateindex(A,+,v,i,j)`, see the discussion below.</p><pre><code class="language-julia">@benchmark fdrand(30,30,30,
    matrixtype=ExtendableSparseMatrix,
    update=(A,v,i,j)-&gt; updateindex!(A,+,v,i,j))</code></pre><pre class="documenter-example-output">BenchmarkTools.Trial: 
  memory estimate:  8.16 MiB
  allocs estimate:  28
  --------------
  minimum time:     8.508 ms (0.00% GC)
  median time:      9.197 ms (0.00% GC)
  mean time:        9.601 ms (1.67% GC)
  maximum time:     14.679 ms (0.00% GC)
  --------------
  samples:          521
  evals/sample:     1</pre><h2 id="Matrix-update-benchmark"><a class="docs-heading-anchor" href="#Matrix-update-benchmark">Matrix update benchmark</a><a id="Matrix-update-benchmark-1"></a><a class="docs-heading-anchor-permalink" href="#Matrix-update-benchmark" title="Permalink"></a></h2><p>For repeated calculations on the same sparsity structure (e.g. for time dependent problems or Newton iterations) it is convenient to skip all but the first creation steps and to just replace the values in the matrix after setting then elements of the <code>nzval</code>  vector to zero. Typically in finite element and finite volume methods this step updates matrix entries (most of them several times) by adding values. In this case, the current indexing interface of Julia requires to access the matrix twice:</p><pre><code class="language-julia">A=spzeros(3,3)
Meta.@lower A[1,2]+=3</code></pre><pre class="documenter-example-output">:($(Expr(:thunk, CodeInfo(
    @ none within `top-level scope&#39;
1 ─ %1 = Base.getindex(A, 1, 2)
│   %2 = %1 + 3
│        Base.setindex!(A, %2, 1, 2)
└──      return %2
))))</pre><p>For sparse matrices this requires to perform the index search in the structure twice. The packages provides the method <a href="../extsparse/#ExtendableSparse.updateindex!-Union{Tuple{Ti}, Tuple{Tv}, Tuple{SparseMatrixLNK{Tv, Ti}, Any, Any, Integer, Integer}} where {Tv, Ti&lt;:Integer}"><code>updateindex!</code></a> for both <code>SparseMatrixCSC</code> and  for <code>ExtendableSparse</code> which allows to update a matrix element with just one index search.</p><h3 id="Benchmark-for-SparseMatrixCSC-2"><a class="docs-heading-anchor" href="#Benchmark-for-SparseMatrixCSC-2">Benchmark for <code>SparseMatrixCSC</code></a><a class="docs-heading-anchor-permalink" href="#Benchmark-for-SparseMatrixCSC-2" title="Permalink"></a></h3><pre><code class="language-julia">A=fdrand(30,30,30, matrixtype=SparseMatrixCSC);
@benchmark fdrand!(A,30,30,30,
                   update=(A,v,i,j)-&gt; A[i,j]+=v)</code></pre><pre class="documenter-example-output">BenchmarkTools.Trial: 
  memory estimate:  48 bytes
  allocs estimate:  1
  --------------
  minimum time:     6.316 ms (0.00% GC)
  median time:      6.479 ms (0.00% GC)
  mean time:        6.552 ms (0.00% GC)
  maximum time:     15.624 ms (0.00% GC)
  --------------
  samples:          763
  evals/sample:     1</pre><pre><code class="language-julia">A=fdrand(30,30,30, matrixtype=SparseMatrixCSC);
@benchmark fdrand!(A,30,30,30,
                   update=(A,v,i,j)-&gt; updateindex!(A,+,v,i,j))</code></pre><pre class="documenter-example-output">BenchmarkTools.Trial: 
  memory estimate:  48 bytes
  allocs estimate:  1
  --------------
  minimum time:     3.745 ms (0.00% GC)
  median time:      3.783 ms (0.00% GC)
  mean time:        3.907 ms (0.00% GC)
  maximum time:     6.397 ms (0.00% GC)
  --------------
  samples:          1280
  evals/sample:     1</pre><h3 id="Benchmark-for-ExtendableSparseMatrix"><a class="docs-heading-anchor" href="#Benchmark-for-ExtendableSparseMatrix">Benchmark for <code>ExtendableSparseMatrix</code></a><a id="Benchmark-for-ExtendableSparseMatrix-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmark-for-ExtendableSparseMatrix" title="Permalink"></a></h3><pre><code class="language-julia">A=fdrand(30,30,30, matrixtype=ExtendableSparseMatrix);
@benchmark fdrand!(A,30,30,30,
                   update=(A,v,i,j)-&gt; A[i,j]+=v)</code></pre><pre class="documenter-example-output">BenchmarkTools.Trial: 
  memory estimate:  0 bytes
  allocs estimate:  0
  --------------
  minimum time:     6.043 ms (0.00% GC)
  median time:      6.224 ms (0.00% GC)
  mean time:        6.307 ms (0.00% GC)
  maximum time:     12.298 ms (0.00% GC)
  --------------
  samples:          793
  evals/sample:     1</pre><pre><code class="language-julia">A=fdrand(30,30,30, matrixtype=ExtendableSparseMatrix);
@benchmark fdrand!(A,30,30,30,
                   update=(A,v,i,j)-&gt; updateindex!(A,+,v,i,j))</code></pre><pre class="documenter-example-output">BenchmarkTools.Trial: 
  memory estimate:  0 bytes
  allocs estimate:  0
  --------------
  minimum time:     3.490 ms (0.00% GC)
  median time:      3.526 ms (0.00% GC)
  mean time:        3.672 ms (0.00% GC)
  maximum time:     7.960 ms (0.00% GC)
  --------------
  samples:          1362
  evals/sample:     1</pre><p>Note that the update process for <code>ExtendableSparse</code> may be slightly slower than for <code>SparseMatrixCSC</code> due to the overhead which comes from checking the presence of new entries.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../extsparse/">Sparse matrix handling »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 29 March 2021 17:22">Monday 29 March 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
